import subprocess, shutil
from pathlib import Path
from typing import Dict, Optional
from schemas import LlmConfig # Import LlmConfig

TOOLS = {
    "python": ["bandit", "-r", ".", "-f", "json"],
    "java": ["spotbugs", "-textui", "-effort:max", "-low"],
    # Add other security analysis tools here for different languages
}

def run_static_pentest(lang: str, cwd: Path, llm_config: Optional[LlmConfig] = None) -> Dict:
    cmd = TOOLS.get(lang)
    if not cmd or shutil.which(cmd[0]) is None:
        return {"tool": None, "results": []}
    try:
        out = subprocess.check_output(cmd, cwd=cwd, stderr=subprocess.STDOUT, text=True, timeout=300)
        return {"tool": cmd[0], "results": out}
    except Exception as e:
        return {"tool": cmd[0], "error": str(e)}

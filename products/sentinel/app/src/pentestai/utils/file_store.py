import os
import json
from datetime import datetime
from typing import Any


class FileStore:
    def __init__(self, root: str = "artifacts"):
        self.root = root
        os.makedirs(self.root, exist_ok=True)

    def path(self, *parts) -> str:
        p = os.path.join(self.root, *parts)
        os.makedirs(os.path.dirname(p), exist_ok=True)
        return p

    def write_text(self, rel: str, text: str) -> str:
        p = self.path(rel)
        with open(p, "w", encoding="utf-8") as f:
            f.write(text)
        return p

    def write_json(self, rel: str, obj: Any) -> str:
        p = self.path(rel)
        with open(p, "w", encoding="utf-8") as f:
            json.dump(obj, f, indent=2)
        return p

    def run_id(self) -> str:
        return datetime.utcnow().strftime("run-%Y%m%dT%H%M%SZ")
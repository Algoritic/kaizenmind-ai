import tempfile
import shutil
from .subproc import run, which

def clone_git(url: str, branch: str | None = None) -> str:
    if which("git") is None:
        raise RuntimeError("git not found in PATH")
    td = tempfile.mkdtemp(prefix="pentestai_repo_")
    c, o, e = run(f"git clone {('-b '+branch+' ') if branch else ''}{url} {td}", timeout=1800)
    if c != 0:
        shutil.rmtree(td, ignore_errors=True)
        raise RuntimeError(f"git clone failed: {e[:300]}")
    return td  

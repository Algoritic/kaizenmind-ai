import logging
from .subproc import run, which

logger = logging.getLogger(__name__)

def nmap_scan(target: str) -> dict:
    logger.info(f"Starting Nmap scan on target: {target}")
    if which("nmap") is None:
        logger.warning("Nmap not found in PATH.")
        return {"tool": "nmap", "error": "not found"}
    
    c, o, e = run(f"nmap -T4 -A -v {target}", timeout=1800)
    
    if c != 0:
        logger.error(f"Nmap scan for {target} failed with code {c}. Stderr: {e}")
    else:
        logger.info(f"Nmap scan for {target} completed successfully.")

    return {"tool": "nmap", "code": c, "stdout": o, "stderr": e}
